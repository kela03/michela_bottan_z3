from z3 import *
'''
Text:
I generated a license key for my password using my program:
04b2fc467e104c0c610e3bf0a009a9f3621905df1997ce0b6cd6a3ea68af4d4deaaf024906f7b259ba32035ac4dad586.

However, I forgot my password! Can you recover it?
'''
s = Solver()

len_v5 = 56
len_input = 48

v_5 = [BitVec(f"v5_{i}",8) for i in range(len_v5)]
input = [BitVec(f"input_{i}",8) for i in range(len_input)]
v_4 = 0

l_key = '04b2fc467e104c0c610e3bf0a009a9f3621905df1997ce0b6cd6a3ea68af4d4deaaf024906f7b259ba32035ac4dad586'

for i in range(0, len(l_key), 2):
    val = int(l_key[i:i+2], 16)
    s.add(v_5[i//2] == val)
    s.add(input[i//2] <= 126)
    s.add(input[i//2] >= 32)

for i in range(12):
    s.add(v_5[v_4] == 33* input[v_4+3] + 89*input[v_4+2] + 103*input[v_4+1] + 66*input[v_4])
    s.add(v_5[v_4+1] == 73*input[v_4] + (-125*input[v_4+1])+ (-103*input[v_4+2]) + 51*input[v_4+3])
    s.add(v_5[v_4+2] == 113*input[v_4+1] + input[v_4+3] + 54*input[v_4] + 8*input[v_4+2])
    s.add(v_5[v_4+3] == 25* input[v_4+2] + 23*input[v_4+3] + 119*input[v_4] + 3*input[v_4+1])
    v_4 += 4

print(s.check())
m = s.model()
print(m)

flag_vals = []

for i in range(len(input)):
    flag_vals.append(m[input[i]].as_long())

flag_cr = ""

for i in range(len(flag_vals)):
    flag_cr += chr(flag_vals[i])
print(flag_cr)